'use strict';

(function (global, factory) {
  if (typeof define === 'function' && define.amd) {
    define(['exports', 'module', './util'], factory);
  } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {
    factory(exports, module, require('./util'));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, mod, global.Util);
    global.tab = mod.exports;
  }
})(undefined, function (exports, module, _util) {
  'use strict';

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ('value' in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
      }
    }return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
  }();

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { 'default': obj };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError('Cannot call a class as a function');
    }
  }

  var _Util = _interopRequireDefault(_util);

  /**
   * --------------------------------------------------------------------------
   * Bootstrap (v4.0.0-alpha.2): tab.js
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
   * --------------------------------------------------------------------------
   */

  var Tab = function ($) {

    /**
     * ------------------------------------------------------------------------
     * Constants
     * ------------------------------------------------------------------------
     */

    var NAME = 'tab';
    var VERSION = '4.0.0-alpha';
    var DATA_KEY = 'bs.tab';
    var EVENT_KEY = '.' + DATA_KEY;
    var DATA_API_KEY = '.data-api';
    var JQUERY_NO_CONFLICT = $.fn[NAME];
    var TRANSITION_DURATION = 150;

    var Event = {
      HIDE: 'hide' + EVENT_KEY,
      HIDDEN: 'hidden' + EVENT_KEY,
      SHOW: 'show' + EVENT_KEY,
      SHOWN: 'shown' + EVENT_KEY,
      CLICK_DATA_API: 'click' + EVENT_KEY + DATA_API_KEY
    };

    var ClassName = {
      DROPDOWN_MENU: 'dropdown-menu',
      ACTIVE: 'active',
      FADE: 'fade',
      IN: 'in'
    };

    var Selector = {
      A: 'a',
      LI: 'li',
      DROPDOWN: '.dropdown',
      UL: 'ul:not(.dropdown-menu)',
      FADE_CHILD: '> .nav-item .fade, > .fade',
      ACTIVE: '.active',
      ACTIVE_CHILD: '> .nav-item > .active, > .active',
      DATA_TOGGLE: '[data-toggle="tab"], [data-toggle="pill"]',
      DROPDOWN_TOGGLE: '.dropdown-toggle',
      DROPDOWN_ACTIVE_CHILD: '> .dropdown-menu .active'
    };

    /**
     * ------------------------------------------------------------------------
     * Class Definition
     * ------------------------------------------------------------------------
     */

    var Tab = function () {
      function Tab(element) {
        _classCallCheck(this, Tab);

        this._element = element;
      }

      /**
       * ------------------------------------------------------------------------
       * Data Api implementation
       * ------------------------------------------------------------------------
       */

      // getters

      _createClass(Tab, [{
        key: 'show',

        // public

        value: function show() {
          var _this = this;

          if (this._element.parentNode && this._element.parentNode.nodeType === Node.ELEMENT_NODE && $(this._element).hasClass(ClassName.ACTIVE)) {
            return;
          }

          var target = undefined;
          var previous = undefined;
          var ulElement = $(this._element).closest(Selector.UL)[0];
          var selector = _Util['default'].getSelectorFromElement(this._element);

          if (ulElement) {
            previous = $.makeArray($(ulElement).find(Selector.ACTIVE));
            previous = previous[previous.length - 1];
          }

          var hideEvent = $.Event(Event.HIDE, {
            relatedTarget: this._element
          });

          var showEvent = $.Event(Event.SHOW, {
            relatedTarget: previous
          });

          if (previous) {
            $(previous).trigger(hideEvent);
          }

          $(this._element).trigger(showEvent);

          if (showEvent.isDefaultPrevented() || hideEvent.isDefaultPrevented()) {
            return;
          }

          if (selector) {
            target = $(selector)[0];
          }

          this._activate(this._element, ulElement);

          var complete = function complete() {
            var hiddenEvent = $.Event(Event.HIDDEN, {
              relatedTarget: _this._element
            });

            var shownEvent = $.Event(Event.SHOWN, {
              relatedTarget: previous
            });

            $(previous).trigger(hiddenEvent);
            $(_this._element).trigger(shownEvent);
          };

          if (target) {
            this._activate(target, target.parentNode, complete);
          } else {
            complete();
          }
        }
      }, {
        key: 'dispose',
        value: function dispose() {
          $.removeClass(this._element, DATA_KEY);
          this._element = null;
        }

        // private

      }, {
        key: '_activate',
        value: function _activate(element, container, callback) {
          var active = $(container).find(Selector.ACTIVE_CHILD)[0];
          var isTransitioning = callback && _Util['default'].supportsTransitionEnd() && (active && $(active).hasClass(ClassName.FADE) || Boolean($(container).find(Selector.FADE_CHILD)[0]));

          var complete = $.proxy(this._transitionComplete, this, element, active, isTransitioning, callback);

          if (active && isTransitioning) {
            $(active).one(_Util['default'].TRANSITION_END, complete).emulateTransitionEnd(TRANSITION_DURATION);
          } else {
            complete();
          }

          if (active) {
            $(active).removeClass(ClassName.IN);
          }
        }
      }, {
        key: '_transitionComplete',
        value: function _transitionComplete(element, active, isTransitioning, callback) {
          if (active) {
            $(active).removeClass(ClassName.ACTIVE);

            var dropdownChild = $(active).find(Selector.DROPDOWN_ACTIVE_CHILD)[0];

            if (dropdownChild) {
              $(dropdownChild).removeClass(ClassName.ACTIVE);
            }

            active.setAttribute('aria-expanded', false);
          }

          $(element).addClass(ClassName.ACTIVE);
          element.setAttribute('aria-expanded', true);

          if (isTransitioning) {
            _Util['default'].reflow(element);
            $(element).addClass(ClassName.IN);
          } else {
            $(element).removeClass(ClassName.FADE);
          }

          if (element.parentNode && $(element.parentNode).hasClass(ClassName.DROPDOWN_MENU)) {

            var dropdownElement = $(element).closest(Selector.DROPDOWN)[0];
            if (dropdownElement) {
              $(dropdownElement).find(Selector.DROPDOWN_TOGGLE).addClass(ClassName.ACTIVE);
            }

            element.setAttribute('aria-expanded', true);
          }

          if (callback) {
            callback();
          }
        }

        // static

      }], [{
        key: '_jQueryInterface',
        value: function _jQueryInterface(config) {
          return this.each(function () {
            var $this = $(this);
            var data = $this.data(DATA_KEY);

            if (!data) {
              data = data = new Tab(this);
              $this.data(DATA_KEY, data);
            }

            if (typeof config === 'string') {
              if (data[config] === undefined) {
                throw new Error('No method named "' + config + '"');
              }
              data[config]();
            }
          });
        }
      }, {
        key: 'VERSION',
        get: function get() {
          return VERSION;
        }
      }]);

      return Tab;
    }();

    $(document).on(Event.CLICK_DATA_API, Selector.DATA_TOGGLE, function (event) {
      event.preventDefault();
      Tab._jQueryInterface.call($(this), 'show');
    });

    /**
     * ------------------------------------------------------------------------
     * jQuery
     * ------------------------------------------------------------------------
     */

    $.fn[NAME] = Tab._jQueryInterface;
    $.fn[NAME].Constructor = Tab;
    $.fn[NAME].noConflict = function () {
      $.fn[NAME] = JQUERY_NO_CONFLICT;
      return Tab._jQueryInterface;
    };

    return Tab;
  }(jQuery);

  module.exports = Tab;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2NsaWVudC9saWIvYm9vdHN0cmFwL2Rpc3QvanMvdW1kL3RhYi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLENBQUMsVUFBVSxNQUFWLEVBQWtCLE9BQWxCLEVBQTJCO0FBQzFCLE1BQUksT0FBTyxNQUFQLEtBQWtCLFVBQWxCLElBQWdDLE9BQU8sR0FBM0MsRUFBZ0Q7QUFDOUMsV0FBTyxDQUFDLFNBQUQsRUFBWSxRQUFaLEVBQXNCLFFBQXRCLENBQVAsRUFBd0MsT0FBeEM7QUFDRCxHQUZELE1BRU8sSUFBSSxPQUFPLE9BQVAsS0FBbUIsV0FBbkIsSUFBa0MsT0FBTyxNQUFQLEtBQWtCLFdBQXhELEVBQXFFO0FBQzFFLFlBQVEsT0FBUixFQUFpQixNQUFqQixFQUF5QixRQUFRLFFBQVIsQ0FBekI7QUFDRCxHQUZNLE1BRUE7QUFDTCxRQUFJLE1BQU07QUFDUixlQUFTO0FBREQsS0FBVjtBQUdBLFlBQVEsSUFBSSxPQUFaLEVBQXFCLEdBQXJCLEVBQTBCLE9BQU8sSUFBakM7QUFDQSxXQUFPLEdBQVAsR0FBYSxJQUFJLE9BQWpCO0FBQ0Q7QUFDRixDQVpELGFBWVMsVUFBVSxPQUFWLEVBQW1CLE1BQW5CLEVBQTJCLEtBQTNCLEVBQWtDO0FBQ3pDOztBQUVBLE1BQUksZUFBZ0IsWUFBWTtBQUFFLGFBQVMsZ0JBQVQsQ0FBMEIsTUFBMUIsRUFBa0MsS0FBbEMsRUFBeUM7QUFBRSxXQUFLLElBQUksSUFBSSxDQUFiLEVBQWdCLElBQUksTUFBTSxNQUExQixFQUFrQyxHQUFsQyxFQUF1QztBQUFFLFlBQUksYUFBYSxNQUFNLENBQU4sQ0FBakIsQ0FBMkIsV0FBVyxVQUFYLEdBQXdCLFdBQVcsVUFBWCxJQUF5QixLQUFqRCxDQUF3RCxXQUFXLFlBQVgsR0FBMEIsSUFBMUIsQ0FBZ0MsSUFBSSxXQUFXLFVBQWYsRUFBMkIsV0FBVyxRQUFYLEdBQXNCLElBQXRCLENBQTRCLE9BQU8sY0FBUCxDQUFzQixNQUF0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SUFBSSxnQkFBWDtBQUNELEtBSEQ7O0FBS0EsV0FBTyxHQUFQO0FBQ0QsR0F4UFMsQ0F3UFAsTUF4UE8sQ0FBVjs7QUEwUEEsU0FBTyxPQUFQLEdBQWlCLEdBQWpCO0FBQ0QsQ0F6UkQiLCJmaWxlIjoidGFiLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShbJ2V4cG9ydHMnLCAnbW9kdWxlJywgJy4vdXRpbCddLCBmYWN0b3J5KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBmYWN0b3J5KGV4cG9ydHMsIG1vZHVsZSwgcmVxdWlyZSgnLi91dGlsJykpO1xuICB9IGVsc2Uge1xuICAgIHZhciBtb2QgPSB7XG4gICAgICBleHBvcnRzOiB7fVxuICAgIH07XG4gICAgZmFjdG9yeShtb2QuZXhwb3J0cywgbW9kLCBnbG9iYWwuVXRpbCk7XG4gICAgZ2xvYmFsLnRhYiA9IG1vZC5leHBvcnRzO1xuICB9XG59KSh0aGlzLCBmdW5jdGlvbiAoZXhwb3J0cywgbW9kdWxlLCBfdXRpbCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTtcblxuICBmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyAnZGVmYXVsdCc6IG9iaiB9OyB9XG5cbiAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9XG5cbiAgdmFyIF9VdGlsID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbCk7XG5cbiAgLyoqXG4gICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAqIEJvb3RzdHJhcCAodjQuMC4wLWFscGhhLjIpOiB0YWIuanNcbiAgICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgdmFyIFRhYiA9IChmdW5jdGlvbiAoJCkge1xuXG4gICAgLyoqXG4gICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICogQ29uc3RhbnRzXG4gICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICovXG5cbiAgICB2YXIgTkFNRSA9ICd0YWInO1xuICAgIHZhciBWRVJTSU9OID0gJzQuMC4wLWFscGhhJztcbiAgICB2YXIgREFUQV9LRVkgPSAnYnMudGFiJztcbiAgICB2YXIgRVZFTlRfS0VZID0gJy4nICsgREFUQV9LRVk7XG4gICAgdmFyIERBVEFfQVBJX0tFWSA9ICcuZGF0YS1hcGknO1xuICAgIHZhciBKUVVFUllfTk9fQ09ORkxJQ1QgPSAkLmZuW05BTUVdO1xuICAgIHZhciBUUkFOU0lUSU9OX0RVUkFUSU9OID0gMTUwO1xuXG4gICAgdmFyIEV2ZW50ID0ge1xuICAgICAgSElERTogJ2hpZGUnICsgRVZFTlRfS0VZLFxuICAgICAgSElEREVOOiAnaGlkZGVuJyArIEVWRU5UX0tFWSxcbiAgICAgIFNIT1c6ICdzaG93JyArIEVWRU5UX0tFWSxcbiAgICAgIFNIT1dOOiAnc2hvd24nICsgRVZFTlRfS0VZLFxuICAgICAgQ0xJQ0tfREFUQV9BUEk6ICdjbGljaycgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVlcbiAgICB9O1xuXG4gICAgdmFyIENsYXNzTmFtZSA9IHtcbiAgICAgIERST1BET1dOX01FTlU6ICdkcm9wZG93bi1tZW51JyxcbiAgICAgIEFDVElWRTogJ2FjdGl2ZScsXG4gICAgICBGQURFOiAnZmFkZScsXG4gICAgICBJTjogJ2luJ1xuICAgIH07XG5cbiAgICB2YXIgU2VsZWN0b3IgPSB7XG4gICAgICBBOiAnYScsXG4gICAgICBMSTogJ2xpJyxcbiAgICAgIERST1BET1dOOiAnLmRyb3Bkb3duJyxcbiAgICAgIFVMOiAndWw6bm90KC5kcm9wZG93bi1tZW51KScsXG4gICAgICBGQURFX0NISUxEOiAnPiAubmF2LWl0ZW0gLmZhZGUsID4gLmZhZGUnLFxuICAgICAgQUNUSVZFOiAnLmFjdGl2ZScsXG4gICAgICBBQ1RJVkVfQ0hJTEQ6ICc+IC5uYXYtaXRlbSA+IC5hY3RpdmUsID4gLmFjdGl2ZScsXG4gICAgICBEQVRBX1RPR0dMRTogJ1tkYXRhLXRvZ2dsZT1cInRhYlwiXSwgW2RhdGEtdG9nZ2xlPVwicGlsbFwiXScsXG4gICAgICBEUk9QRE9XTl9UT0dHTEU6ICcuZHJvcGRvd24tdG9nZ2xlJyxcbiAgICAgIERST1BET1dOX0FDVElWRV9DSElMRDogJz4gLmRyb3Bkb3duLW1lbnUgLmFjdGl2ZSdcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICogQ2xhc3MgRGVmaW5pdGlvblxuICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAqL1xuXG4gICAgdmFyIFRhYiA9IChmdW5jdGlvbiAoKSB7XG4gICAgICBmdW5jdGlvbiBUYWIoZWxlbWVudCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVGFiKTtcblxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAqIERhdGEgQXBpIGltcGxlbWVudGF0aW9uXG4gICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAqL1xuXG4gICAgICAvLyBnZXR0ZXJzXG5cbiAgICAgIF9jcmVhdGVDbGFzcyhUYWIsIFt7XG4gICAgICAgIGtleTogJ3Nob3cnLFxuXG4gICAgICAgIC8vIHB1YmxpY1xuXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBzaG93KCkge1xuICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgICAgICBpZiAodGhpcy5fZWxlbWVudC5wYXJlbnROb2RlICYmIHRoaXMuX2VsZW1lbnQucGFyZW50Tm9kZS5ub2RlVHlwZSA9PT0gTm9kZS5FTEVNRU5UX05PREUgJiYgJCh0aGlzLl9lbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuQUNUSVZFKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciB0YXJnZXQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgdmFyIHByZXZpb3VzID0gdW5kZWZpbmVkO1xuICAgICAgICAgIHZhciB1bEVsZW1lbnQgPSAkKHRoaXMuX2VsZW1lbnQpLmNsb3Nlc3QoU2VsZWN0b3IuVUwpWzBdO1xuICAgICAgICAgIHZhciBzZWxlY3RvciA9IF9VdGlsWydkZWZhdWx0J10uZ2V0U2VsZWN0b3JGcm9tRWxlbWVudCh0aGlzLl9lbGVtZW50KTtcblxuICAgICAgICAgIGlmICh1bEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHByZXZpb3VzID0gJC5tYWtlQXJyYXkoJCh1bEVsZW1lbnQpLmZpbmQoU2VsZWN0b3IuQUNUSVZFKSk7XG4gICAgICAgICAgICBwcmV2aW91cyA9IHByZXZpb3VzW3ByZXZpb3VzLmxlbmd0aCAtIDFdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBoaWRlRXZlbnQgPSAkLkV2ZW50KEV2ZW50LkhJREUsIHtcbiAgICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHRoaXMuX2VsZW1lbnRcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHZhciBzaG93RXZlbnQgPSAkLkV2ZW50KEV2ZW50LlNIT1csIHtcbiAgICAgICAgICAgIHJlbGF0ZWRUYXJnZXQ6IHByZXZpb3VzXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAocHJldmlvdXMpIHtcbiAgICAgICAgICAgICQocHJldmlvdXMpLnRyaWdnZXIoaGlkZUV2ZW50KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAkKHRoaXMuX2VsZW1lbnQpLnRyaWdnZXIoc2hvd0V2ZW50KTtcblxuICAgICAgICAgIGlmIChzaG93RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkgfHwgaGlkZUV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHNlbGVjdG9yKSB7XG4gICAgICAgICAgICB0YXJnZXQgPSAkKHNlbGVjdG9yKVswXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLl9hY3RpdmF0ZSh0aGlzLl9lbGVtZW50LCB1bEVsZW1lbnQpO1xuXG4gICAgICAgICAgdmFyIGNvbXBsZXRlID0gZnVuY3Rpb24gY29tcGxldGUoKSB7XG4gICAgICAgICAgICB2YXIgaGlkZGVuRXZlbnQgPSAkLkV2ZW50KEV2ZW50LkhJRERFTiwge1xuICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBfdGhpcy5fZWxlbWVudFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBzaG93bkV2ZW50ID0gJC5FdmVudChFdmVudC5TSE9XTiwge1xuICAgICAgICAgICAgICByZWxhdGVkVGFyZ2V0OiBwcmV2aW91c1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQocHJldmlvdXMpLnRyaWdnZXIoaGlkZGVuRXZlbnQpO1xuICAgICAgICAgICAgJChfdGhpcy5fZWxlbWVudCkudHJpZ2dlcihzaG93bkV2ZW50KTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZhdGUodGFyZ2V0LCB0YXJnZXQucGFyZW50Tm9kZSwgY29tcGxldGUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6ICdkaXNwb3NlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgICAgICAgJC5yZW1vdmVDbGFzcyh0aGlzLl9lbGVtZW50LCBEQVRBX0tFWSk7XG4gICAgICAgICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBwcml2YXRlXG5cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnX2FjdGl2YXRlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9hY3RpdmF0ZShlbGVtZW50LCBjb250YWluZXIsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyIGFjdGl2ZSA9ICQoY29udGFpbmVyKS5maW5kKFNlbGVjdG9yLkFDVElWRV9DSElMRClbMF07XG4gICAgICAgICAgdmFyIGlzVHJhbnNpdGlvbmluZyA9IGNhbGxiYWNrICYmIF9VdGlsWydkZWZhdWx0J10uc3VwcG9ydHNUcmFuc2l0aW9uRW5kKCkgJiYgKGFjdGl2ZSAmJiAkKGFjdGl2ZSkuaGFzQ2xhc3MoQ2xhc3NOYW1lLkZBREUpIHx8IEJvb2xlYW4oJChjb250YWluZXIpLmZpbmQoU2VsZWN0b3IuRkFERV9DSElMRClbMF0pKTtcblxuICAgICAgICAgIHZhciBjb21wbGV0ZSA9ICQucHJveHkodGhpcy5fdHJhbnNpdGlvbkNvbXBsZXRlLCB0aGlzLCBlbGVtZW50LCBhY3RpdmUsIGlzVHJhbnNpdGlvbmluZywgY2FsbGJhY2spO1xuXG4gICAgICAgICAgaWYgKGFjdGl2ZSAmJiBpc1RyYW5zaXRpb25pbmcpIHtcbiAgICAgICAgICAgICQoYWN0aXZlKS5vbmUoX1V0aWxbJ2RlZmF1bHQnXS5UUkFOU0lUSU9OX0VORCwgY29tcGxldGUpLmVtdWxhdGVUcmFuc2l0aW9uRW5kKFRSQU5TSVRJT05fRFVSQVRJT04pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZSgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChhY3RpdmUpIHtcbiAgICAgICAgICAgICQoYWN0aXZlKS5yZW1vdmVDbGFzcyhDbGFzc05hbWUuSU4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6ICdfdHJhbnNpdGlvbkNvbXBsZXRlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF90cmFuc2l0aW9uQ29tcGxldGUoZWxlbWVudCwgYWN0aXZlLCBpc1RyYW5zaXRpb25pbmcsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgaWYgKGFjdGl2ZSkge1xuICAgICAgICAgICAgJChhY3RpdmUpLnJlbW92ZUNsYXNzKENsYXNzTmFtZS5BQ1RJVkUpO1xuXG4gICAgICAgICAgICB2YXIgZHJvcGRvd25DaGlsZCA9ICQoYWN0aXZlKS5maW5kKFNlbGVjdG9yLkRST1BET1dOX0FDVElWRV9DSElMRClbMF07XG5cbiAgICAgICAgICAgIGlmIChkcm9wZG93bkNoaWxkKSB7XG4gICAgICAgICAgICAgICQoZHJvcGRvd25DaGlsZCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkFDVElWRSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFjdGl2ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCBmYWxzZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJChlbGVtZW50KS5hZGRDbGFzcyhDbGFzc05hbWUuQUNUSVZFKTtcbiAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIHRydWUpO1xuXG4gICAgICAgICAgaWYgKGlzVHJhbnNpdGlvbmluZykge1xuICAgICAgICAgICAgX1V0aWxbJ2RlZmF1bHQnXS5yZWZsb3coZWxlbWVudCk7XG4gICAgICAgICAgICAkKGVsZW1lbnQpLmFkZENsYXNzKENsYXNzTmFtZS5JTik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoZWxlbWVudCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLkZBREUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChlbGVtZW50LnBhcmVudE5vZGUgJiYgJChlbGVtZW50LnBhcmVudE5vZGUpLmhhc0NsYXNzKENsYXNzTmFtZS5EUk9QRE9XTl9NRU5VKSkge1xuXG4gICAgICAgICAgICB2YXIgZHJvcGRvd25FbGVtZW50ID0gJChlbGVtZW50KS5jbG9zZXN0KFNlbGVjdG9yLkRST1BET1dOKVswXTtcbiAgICAgICAgICAgIGlmIChkcm9wZG93bkVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgJChkcm9wZG93bkVsZW1lbnQpLmZpbmQoU2VsZWN0b3IuRFJPUERPV05fVE9HR0xFKS5hZGRDbGFzcyhDbGFzc05hbWUuQUNUSVZFKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gc3RhdGljXG5cbiAgICAgIH1dLCBbe1xuICAgICAgICBrZXk6ICdfalF1ZXJ5SW50ZXJmYWNlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9qUXVlcnlJbnRlcmZhY2UoY29uZmlnKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyIGRhdGEgPSAkdGhpcy5kYXRhKERBVEFfS0VZKTtcblxuICAgICAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBkYXRhID0gbmV3IFRhYih0aGlzKTtcbiAgICAgICAgICAgICAgJHRoaXMuZGF0YShEQVRBX0tFWSwgZGF0YSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBpZiAoZGF0YVtjb25maWddID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG1ldGhvZCBuYW1lZCBcIicgKyBjb25maWcgKyAnXCInKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkYXRhW2NvbmZpZ10oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6ICdWRVJTSU9OJyxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIFZFUlNJT047XG4gICAgICAgIH1cbiAgICAgIH1dKTtcblxuICAgICAgcmV0dXJuIFRhYjtcbiAgICB9KSgpO1xuXG4gICAgJChkb2N1bWVudCkub24oRXZlbnQuQ0xJQ0tfREFUQV9BUEksIFNlbGVjdG9yLkRBVEFfVE9HR0xFLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBUYWIuX2pRdWVyeUludGVyZmFjZS5jYWxsKCQodGhpcyksICdzaG93Jyk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKiBqUXVlcnlcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKi9cblxuICAgICQuZm5bTkFNRV0gPSBUYWIuX2pRdWVyeUludGVyZmFjZTtcbiAgICAkLmZuW05BTUVdLkNvbnN0cnVjdG9yID0gVGFiO1xuICAgICQuZm5bTkFNRV0ubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICQuZm5bTkFNRV0gPSBKUVVFUllfTk9fQ09ORkxJQ1Q7XG4gICAgICByZXR1cm4gVGFiLl9qUXVlcnlJbnRlcmZhY2U7XG4gICAgfTtcblxuICAgIHJldHVybiBUYWI7XG4gIH0pKGpRdWVyeSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBUYWI7XG59KTtcbiJdfQ==