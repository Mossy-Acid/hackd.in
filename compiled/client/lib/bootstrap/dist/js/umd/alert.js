'use strict';

(function (global, factory) {
  if (typeof define === 'function' && define.amd) {
    define(['exports', 'module', './util'], factory);
  } else if (typeof exports !== 'undefined' && typeof module !== 'undefined') {
    factory(exports, module, require('./util'));
  } else {
    var mod = {
      exports: {}
    };
    factory(mod.exports, mod, global.Util);
    global.alert = mod.exports;
  }
})(undefined, function (exports, module, _util) {
  'use strict';

  var _createClass = function () {
    function defineProperties(target, props) {
      for (var i = 0; i < props.length; i++) {
        var descriptor = props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if ('value' in descriptor) descriptor.writable = true;Object.defineProperty(target, descriptor.key, descriptor);
      }
    }return function (Constructor, protoProps, staticProps) {
      if (protoProps) defineProperties(Constructor.prototype, protoProps);if (staticProps) defineProperties(Constructor, staticProps);return Constructor;
    };
  }();

  function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { 'default': obj };
  }

  function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
      throw new TypeError('Cannot call a class as a function');
    }
  }

  var _Util = _interopRequireDefault(_util);

  /**
   * --------------------------------------------------------------------------
   * Bootstrap (v4.0.0-alpha.2): alert.js
   * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
   * --------------------------------------------------------------------------
   */

  var Alert = function ($) {

    /**
     * ------------------------------------------------------------------------
     * Constants
     * ------------------------------------------------------------------------
     */

    var NAME = 'alert';
    var VERSION = '4.0.0-alpha';
    var DATA_KEY = 'bs.alert';
    var EVENT_KEY = '.' + DATA_KEY;
    var DATA_API_KEY = '.data-api';
    var JQUERY_NO_CONFLICT = $.fn[NAME];
    var TRANSITION_DURATION = 150;

    var Selector = {
      DISMISS: '[data-dismiss="alert"]'
    };

    var Event = {
      CLOSE: 'close' + EVENT_KEY,
      CLOSED: 'closed' + EVENT_KEY,
      CLICK_DATA_API: 'click' + EVENT_KEY + DATA_API_KEY
    };

    var ClassName = {
      ALERT: 'alert',
      FADE: 'fade',
      IN: 'in'
    };

    /**
     * ------------------------------------------------------------------------
     * Class Definition
     * ------------------------------------------------------------------------
     */

    var Alert = function () {
      function Alert(element) {
        _classCallCheck(this, Alert);

        this._element = element;
      }

      /**
       * ------------------------------------------------------------------------
       * Data Api implementation
       * ------------------------------------------------------------------------
       */

      // getters

      _createClass(Alert, [{
        key: 'close',

        // public

        value: function close(element) {
          element = element || this._element;

          var rootElement = this._getRootElement(element);
          var customEvent = this._triggerCloseEvent(rootElement);

          if (customEvent.isDefaultPrevented()) {
            return;
          }

          this._removeElement(rootElement);
        }
      }, {
        key: 'dispose',
        value: function dispose() {
          $.removeData(this._element, DATA_KEY);
          this._element = null;
        }

        // private

      }, {
        key: '_getRootElement',
        value: function _getRootElement(element) {
          var selector = _Util['default'].getSelectorFromElement(element);
          var parent = false;

          if (selector) {
            parent = $(selector)[0];
          }

          if (!parent) {
            parent = $(element).closest('.' + ClassName.ALERT)[0];
          }

          return parent;
        }
      }, {
        key: '_triggerCloseEvent',
        value: function _triggerCloseEvent(element) {
          var closeEvent = $.Event(Event.CLOSE);

          $(element).trigger(closeEvent);
          return closeEvent;
        }
      }, {
        key: '_removeElement',
        value: function _removeElement(element) {
          $(element).removeClass(ClassName.IN);

          if (!_Util['default'].supportsTransitionEnd() || !$(element).hasClass(ClassName.FADE)) {
            this._destroyElement(element);
            return;
          }

          $(element).one(_Util['default'].TRANSITION_END, $.proxy(this._destroyElement, this, element)).emulateTransitionEnd(TRANSITION_DURATION);
        }
      }, {
        key: '_destroyElement',
        value: function _destroyElement(element) {
          $(element).detach().trigger(Event.CLOSED).remove();
        }

        // static

      }], [{
        key: '_jQueryInterface',
        value: function _jQueryInterface(config) {
          return this.each(function () {
            var $element = $(this);
            var data = $element.data(DATA_KEY);

            if (!data) {
              data = new Alert(this);
              $element.data(DATA_KEY, data);
            }

            if (config === 'close') {
              data[config](this);
            }
          });
        }
      }, {
        key: '_handleDismiss',
        value: function _handleDismiss(alertInstance) {
          return function (event) {
            if (event) {
              event.preventDefault();
            }

            alertInstance.close(this);
          };
        }
      }, {
        key: 'VERSION',
        get: function get() {
          return VERSION;
        }
      }]);

      return Alert;
    }();

    $(document).on(Event.CLICK_DATA_API, Selector.DISMISS, Alert._handleDismiss(new Alert()));

    /**
     * ------------------------------------------------------------------------
     * jQuery
     * ------------------------------------------------------------------------
     */

    $.fn[NAME] = Alert._jQueryInterface;
    $.fn[NAME].Constructor = Alert;
    $.fn[NAME].noConflict = function () {
      $.fn[NAME] = JQUERY_NO_CONFLICT;
      return Alert._jQueryInterface;
    };

    return Alert;
  }(jQuery);

  module.exports = Alert;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2NsaWVudC9saWIvYm9vdHN0cmFwL2Rpc3QvanMvdW1kL2FsZXJ0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsQ0FBQyxVQUFVLE1BQVYsRUFBa0IsT0FBbEIsRUFBMkI7QUFDMUIsTUFBSSxPQUFPLE1BQVAsS0FBa0IsVUFBbEIsSUFBZ0MsT0FBTyxHQUEzQyxFQUFnRDtBQUM5QyxXQUFPLENBQUMsU0FBRCxFQUFZLFFBQVosRUFBc0IsUUFBdEIsQ0FBUCxFQUF3QyxPQUF4QztBQUNELEdBRkQsTUFFTyxJQUFJLE9BQU8sT0FBUCxLQUFtQixXQUFuQixJQUFrQyxPQUFPLE1BQVAsS0FBa0IsV0FBeEQsRUFBcUU7QUFDMUUsWUFBUSxPQUFSLEVBQWlCLE1BQWpCLEVBQXlCLFFBQVEsUUFBUixDQUF6QjtBQUNELEdBRk0sTUFFQTtBQUNMLFFBQUksTUFBTTtBQUNSLGVBQVM7QUFERCxLQUFWO0FBR0EsWUFBUSxJQUFJLE9BQVosRUFBcUIsR0FBckIsRUFBMEIsT0FBTyxJQUFqQztBQUNBLFdBQU8sS0FBUCxHQUFlLElBQUksT0FBbkI7QUFDRDtBQUNGLENBWkQsYUFZUyxVQUFVLE9BQVYsRUFBbUIsTUFBbkIsRUFBMkIsS0FBM0IsRUFBa0M7QUFDekM7O0FBRUEsTUFBSSxlQUFnQixZQUFZO0FBQUUsYUFBUyxnQkFBVCxDQUEwQixNQUExQixFQUFrQyxLQUFsQyxFQUF5QztBQUFFLFdBQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxNQUFNLE1BQTFCLEVBQWtDLEdBQWxDLEVBQXVDO0FBQUUsWUFBSSxhQUFhLE1BQU0sQ0FBTixDQUFqQixDQUEyQixXQUFXLFVBQVgsR0FBd0IsV0FBVyxVQUFYLElBQXlCLEtBQWpELENBQXdELFdBQVcsWUFBWCxHQUEwQixJQUExQixDQUFnQyxJQUFJLFdBQVcsVUFBZixFQUEyQixXQUFXLFFBQVgsR0FBc0IsSUFBdEIsQ0FBNEIsT0FBTyxjQUFQLENBQXNCLE1B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TyxPQUFQLEdBQWlCLEtBQWpCO0FBQ0QsQ0FsTkQiLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKFsnZXhwb3J0cycsICdtb2R1bGUnLCAnLi91dGlsJ10sIGZhY3RvcnkpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIGZhY3RvcnkoZXhwb3J0cywgbW9kdWxlLCByZXF1aXJlKCcuL3V0aWwnKSk7XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1vZCA9IHtcbiAgICAgIGV4cG9ydHM6IHt9XG4gICAgfTtcbiAgICBmYWN0b3J5KG1vZC5leHBvcnRzLCBtb2QsIGdsb2JhbC5VdGlsKTtcbiAgICBnbG9iYWwuYWxlcnQgPSBtb2QuZXhwb3J0cztcbiAgfVxufSkodGhpcywgZnVuY3Rpb24gKGV4cG9ydHMsIG1vZHVsZSwgX3V0aWwpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24gKCkgeyBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7XG5cbiAgZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgJ2RlZmF1bHQnOiBvYmogfTsgfVxuXG4gIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uJyk7IH0gfVxuXG4gIHZhciBfVXRpbCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3V0aWwpO1xuXG4gIC8qKlxuICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgKiBCb290c3RyYXAgKHY0LjAuMC1hbHBoYS4yKTogYWxlcnQuanNcbiAgICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICovXG5cbiAgdmFyIEFsZXJ0ID0gKGZ1bmN0aW9uICgkKSB7XG5cbiAgICAvKipcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKiBDb25zdGFudHNcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKi9cblxuICAgIHZhciBOQU1FID0gJ2FsZXJ0JztcbiAgICB2YXIgVkVSU0lPTiA9ICc0LjAuMC1hbHBoYSc7XG4gICAgdmFyIERBVEFfS0VZID0gJ2JzLmFsZXJ0JztcbiAgICB2YXIgRVZFTlRfS0VZID0gJy4nICsgREFUQV9LRVk7XG4gICAgdmFyIERBVEFfQVBJX0tFWSA9ICcuZGF0YS1hcGknO1xuICAgIHZhciBKUVVFUllfTk9fQ09ORkxJQ1QgPSAkLmZuW05BTUVdO1xuICAgIHZhciBUUkFOU0lUSU9OX0RVUkFUSU9OID0gMTUwO1xuXG4gICAgdmFyIFNlbGVjdG9yID0ge1xuICAgICAgRElTTUlTUzogJ1tkYXRhLWRpc21pc3M9XCJhbGVydFwiXSdcbiAgICB9O1xuXG4gICAgdmFyIEV2ZW50ID0ge1xuICAgICAgQ0xPU0U6ICdjbG9zZScgKyBFVkVOVF9LRVksXG4gICAgICBDTE9TRUQ6ICdjbG9zZWQnICsgRVZFTlRfS0VZLFxuICAgICAgQ0xJQ0tfREFUQV9BUEk6ICdjbGljaycgKyBFVkVOVF9LRVkgKyBEQVRBX0FQSV9LRVlcbiAgICB9O1xuXG4gICAgdmFyIENsYXNzTmFtZSA9IHtcbiAgICAgIEFMRVJUOiAnYWxlcnQnLFxuICAgICAgRkFERTogJ2ZhZGUnLFxuICAgICAgSU46ICdpbidcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICogQ2xhc3MgRGVmaW5pdGlvblxuICAgICAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAqL1xuXG4gICAgdmFyIEFsZXJ0ID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgIGZ1bmN0aW9uIEFsZXJ0KGVsZW1lbnQpIHtcbiAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEFsZXJ0KTtcblxuICAgICAgICB0aGlzLl9lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAqIERhdGEgQXBpIGltcGxlbWVudGF0aW9uXG4gICAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAqL1xuXG4gICAgICAvLyBnZXR0ZXJzXG5cbiAgICAgIF9jcmVhdGVDbGFzcyhBbGVydCwgW3tcbiAgICAgICAga2V5OiAnY2xvc2UnLFxuXG4gICAgICAgIC8vIHB1YmxpY1xuXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjbG9zZShlbGVtZW50KSB7XG4gICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQgfHwgdGhpcy5fZWxlbWVudDtcblxuICAgICAgICAgIHZhciByb290RWxlbWVudCA9IHRoaXMuX2dldFJvb3RFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICAgIHZhciBjdXN0b21FdmVudCA9IHRoaXMuX3RyaWdnZXJDbG9zZUV2ZW50KHJvb3RFbGVtZW50KTtcblxuICAgICAgICAgIGlmIChjdXN0b21FdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuX3JlbW92ZUVsZW1lbnQocm9vdEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ2Rpc3Bvc2UnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZGlzcG9zZSgpIHtcbiAgICAgICAgICAkLnJlbW92ZURhdGEodGhpcy5fZWxlbWVudCwgREFUQV9LRVkpO1xuICAgICAgICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcHJpdmF0ZVxuXG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ19nZXRSb290RWxlbWVudCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0Um9vdEVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICAgIHZhciBzZWxlY3RvciA9IF9VdGlsWydkZWZhdWx0J10uZ2V0U2VsZWN0b3JGcm9tRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICB2YXIgcGFyZW50ID0gZmFsc2U7XG5cbiAgICAgICAgICBpZiAoc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIHBhcmVudCA9ICQoc2VsZWN0b3IpWzBdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICBwYXJlbnQgPSAkKGVsZW1lbnQpLmNsb3Nlc3QoJy4nICsgQ2xhc3NOYW1lLkFMRVJUKVswXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcGFyZW50O1xuICAgICAgICB9XG4gICAgICB9LCB7XG4gICAgICAgIGtleTogJ190cmlnZ2VyQ2xvc2VFdmVudCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfdHJpZ2dlckNsb3NlRXZlbnQoZWxlbWVudCkge1xuICAgICAgICAgIHZhciBjbG9zZUV2ZW50ID0gJC5FdmVudChFdmVudC5DTE9TRSk7XG5cbiAgICAgICAgICAkKGVsZW1lbnQpLnRyaWdnZXIoY2xvc2VFdmVudCk7XG4gICAgICAgICAgcmV0dXJuIGNsb3NlRXZlbnQ7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnX3JlbW92ZUVsZW1lbnQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZUVsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICAgICQoZWxlbWVudCkucmVtb3ZlQ2xhc3MoQ2xhc3NOYW1lLklOKTtcblxuICAgICAgICAgIGlmICghX1V0aWxbJ2RlZmF1bHQnXS5zdXBwb3J0c1RyYW5zaXRpb25FbmQoKSB8fCAhJChlbGVtZW50KS5oYXNDbGFzcyhDbGFzc05hbWUuRkFERSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2Rlc3Ryb3lFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICQoZWxlbWVudCkub25lKF9VdGlsWydkZWZhdWx0J10uVFJBTlNJVElPTl9FTkQsICQucHJveHkodGhpcy5fZGVzdHJveUVsZW1lbnQsIHRoaXMsIGVsZW1lbnQpKS5lbXVsYXRlVHJhbnNpdGlvbkVuZChUUkFOU0lUSU9OX0RVUkFUSU9OKTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBrZXk6ICdfZGVzdHJveUVsZW1lbnQnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2Rlc3Ryb3lFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgICAgICAkKGVsZW1lbnQpLmRldGFjaCgpLnRyaWdnZXIoRXZlbnQuQ0xPU0VEKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHN0YXRpY1xuXG4gICAgICB9XSwgW3tcbiAgICAgICAga2V5OiAnX2pRdWVyeUludGVyZmFjZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfalF1ZXJ5SW50ZXJmYWNlKGNvbmZpZykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJCh0aGlzKTtcbiAgICAgICAgICAgIHZhciBkYXRhID0gJGVsZW1lbnQuZGF0YShEQVRBX0tFWSk7XG5cbiAgICAgICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgICBkYXRhID0gbmV3IEFsZXJ0KHRoaXMpO1xuICAgICAgICAgICAgICAkZWxlbWVudC5kYXRhKERBVEFfS0VZLCBkYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGNvbmZpZyA9PT0gJ2Nsb3NlJykge1xuICAgICAgICAgICAgICBkYXRhW2NvbmZpZ10odGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnX2hhbmRsZURpc21pc3MnLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX2hhbmRsZURpc21pc3MoYWxlcnRJbnN0YW5jZSkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhbGVydEluc3RhbmNlLmNsb3NlKHRoaXMpO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sIHtcbiAgICAgICAga2V5OiAnVkVSU0lPTicsXG4gICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuICAgICAgICAgIHJldHVybiBWRVJTSU9OO1xuICAgICAgICB9XG4gICAgICB9XSk7XG5cbiAgICAgIHJldHVybiBBbGVydDtcbiAgICB9KSgpO1xuXG4gICAgJChkb2N1bWVudCkub24oRXZlbnQuQ0xJQ0tfREFUQV9BUEksIFNlbGVjdG9yLkRJU01JU1MsIEFsZXJ0Ll9oYW5kbGVEaXNtaXNzKG5ldyBBbGVydCgpKSk7XG5cbiAgICAvKipcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKiBqUXVlcnlcbiAgICAgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgKi9cblxuICAgICQuZm5bTkFNRV0gPSBBbGVydC5falF1ZXJ5SW50ZXJmYWNlO1xuICAgICQuZm5bTkFNRV0uQ29uc3RydWN0b3IgPSBBbGVydDtcbiAgICAkLmZuW05BTUVdLm5vQ29uZmxpY3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAkLmZuW05BTUVdID0gSlFVRVJZX05PX0NPTkZMSUNUO1xuICAgICAgcmV0dXJuIEFsZXJ0Ll9qUXVlcnlJbnRlcmZhY2U7XG4gICAgfTtcblxuICAgIHJldHVybiBBbGVydDtcbiAgfSkoalF1ZXJ5KTtcblxuICBtb2R1bGUuZXhwb3J0cyA9IEFsZXJ0O1xufSk7XG4iXX0=